@model IEnumerable<Book>
@{
    ViewData["Title"] = "Home Page";
    var hasAccess = User.Claims.Any(c => c.Type == ClaimTypes.Role && (c.Value == "Admin" || c.Value == "Developer" || c.Value == "CEO"));
}

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.2/dist/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.11/dist/jquery.validate.unobtrusive.min.js"></script>

<div class="container my-5">
    @if (hasAccess)
    {
        <div class="text-center mb-4">
            <span class="badge badge-pill badge-info px-4 py-2" style="font-size:1.1rem;">Book Creation</span>
        </div>
        <form asp-controller="Book" asp-action="Add" enctype="multipart/form-data" id="addBookForm" class="p-3 rounded bg-light shadow-sm">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="Name"><i class="fas fa-book mr-1"></i> Name</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-book"></i></span>
                        </div>
                        <input type="text" name="Name" id="Name" class="form-control" placeholder="Enter book name" required>
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label for="Author"><i class="fas fa-user-edit mr-1"></i> Author</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-user-edit"></i></span>
                        </div>
                        <input type="text" name="Author" id="Author" class="form-control" placeholder="Enter author name" required>
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label for="PublicationYear"><i class="fas fa-calendar-alt mr-1"></i> Publication Year</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                        </div>
                        <input type="text" name="PublicationYear" id="PublicationYear" class="form-control" placeholder="YYYY" required>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="Genre"><i class="fas fa-tags mr-1"></i> Genre</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-tags"></i></span>
                        </div>
                        <input type="text" name="Genre" id="Genre" class="form-control" placeholder="Enter genre" required>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="Language"><i class="fas fa-language mr-1"></i> Language</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-language"></i></span>
                        </div>
                        <input type="text" name="Language" id="Language" class="form-control" placeholder="Enter language" required>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="Description"><i class="fas fa-align-left mr-1"></i> Description</label>
                <textarea name="Description" id="Description" class="form-control" rows="4" placeholder="Write a brief description" required></textarea>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="avatar"><i class="fas fa-image mr-1"></i> Layout Image</label>
                    <div class="custom-file">
                        <input type="file" id="avatar" name="avatar" class="custom-file-input" accept=".jpg">
                        <label class="custom-file-label" for="avatar">Choose layout image (JPG)</label>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="bookFile"><i class="fas fa-file-pdf mr-1"></i> PDF File</label>
                    <div class="custom-file">
                        <input type="file" id="bookFile" name="bookFile" class="custom-file-input" accept=".pdf" required>
                        <label class="custom-file-label" for="bookFile">Choose book file (PDF)</label>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg px-5 shadow" id="addBookButton" disabled>
                    <i class="fas fa-plus-circle mr-2"></i> Add Book
                </button>
            </div>
        </form>
        <!-- Modern Book Creation Form End -->
    }

    <h2 class="text-center mb-4">Library</h2>
    <div class="row">
        @foreach (var book in Model)
        {
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <img src="@(book.LayoutUrl ?? "https://static.vecteezy.com/system/resources/previews/000/357/095/non_2x/vector-book-icon.jpg")" class="card-img-top" alt="@book.Name">
                    <div class="card-body">
                        <h5 class="card-title">@book.Name</h5>
                        <p class="card-text"><strong>Author:</strong> @book.Author</p>
                        <p class="card-text"><strong>Year:</strong> @book.PublicationYear</p>
                        <p class="card-text"><strong>Genre:</strong> @book.Genre</p>
                        <p class="card-text"><strong>Language:</strong> @book.Language</p>
                        <p class="card-text text-truncate" title="@book.Description">@book.Description</p>
                        <a href="@Url.Action("GetById", "Book", new { id = book.Id })" class="btn btn-outline-primary btn-sm">Details</a>
                        @if (hasAccess)
                        {
                            <a href="@Url.Action("DeleteBook", "Book", new { id = book.Id })" class="btn btn-outline-danger btn-sm ml-2">Delete</a>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#addBookForm').validate({
            rules: {
                PublicationYear: {
                    required: true,
                    number: true,
                    max: new Date().getFullYear()
                }
            },
            messages: {
                PublicationYear: {
                    required: "Publication Year is required",
                    number: "Please enter a valid year",
                    max: "Year must be less than or equal to " + new Date().getFullYear()
                }
            }
        });

        $('#addBookForm input, #addBookForm textarea').on('keyup change', function () {
            $('#addBookButton').prop('disabled', !$('#addBookForm').valid());
        });
    });
</script>
